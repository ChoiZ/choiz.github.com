<!DOCTYPE html>
<html lang="fr">
<head>
  <link href="//fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700,400italic" rel="stylesheet" type="text/css">
  <link rel="stylesheet" type="text/css" href="//www.choiz.fr/theme/css/style.min.css">
  <link rel="stylesheet" type="text/css" href="//www.choiz.fr/theme/css/pygments.min.css">
  <link rel="stylesheet" type="text/css" href="//www.choiz.fr/theme/css/font-awesome.min.css">
  <link href="//www.choiz.fr/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="ChoiZ Atom">
  <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
  <link rel="icon" href="favicon.ico" type="image/x-icon">
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="index, follow" />
<meta name="author" content="choiz" />
<meta name="description" content="J'ai acheté il y a quelques années un HP Microserver Gen7 qui me sert de NAS, dessus j'avais installé Debian 6 à l'époque puis j'ai mis à jour jusqu'à la version 9. Mon objectif est l'ajout d'un disque car j'ai 4 emplacements pour le stockage et je n'utilisais que 3 …" />
<meta name="keywords" content="NAS, HP, Microserver, Debian, Proxmox, Stockage, Data">
<meta property="og:site_name" content="ChoiZ"/>
<meta property="og:title" content="Upgrade NAS"/>
<meta property="og:description" content="J'ai acheté il y a quelques années un HP Microserver Gen7 qui me sert de NAS, dessus j'avais installé Debian 6 à l'époque puis j'ai mis à jour jusqu'à la version 9. Mon objectif est l'ajout d'un disque car j'ai 4 emplacements pour le stockage et je n'utilisais que 3 …"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="//www.choiz.fr/2017-08-26-upgrade-nas.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2017-08-26 11:04:27+02:00"/>
<meta property="article:modified_time" content=""/>
<meta property="article:author" content="//www.choiz.fr/author/choiz.html">
<meta property="article:section" content="text"/>
<meta property="article:tag" content="NAS"/>
<meta property="article:tag" content="HP"/>
<meta property="article:tag" content="Microserver"/>
<meta property="article:tag" content="Debian"/>
<meta property="article:tag" content="Proxmox"/>
<meta property="article:tag" content="Stockage"/>
<meta property="article:tag" content="Data"/>
<meta property="og:image" content="">  <title>ChoiZ &ndash; Upgrade NAS</title>
</head>
<body>
  <aside>
    <div>
      <a href="//www.choiz.fr">
        <img src="//www.choiz.fr/theme/img/profile.png" alt="Blog technique de François LASSERRE" title="Blog technique de François LASSERRE">
      </a>
      <div>
          <a href="//www.choiz.fr">Blog technique de François LASSERRE</a>
      </div>
      <nav>
        <ul class="list">
          <li><a href="/">Home</a></li>
          <li><a href="/archives">Archives</a></li>
          <li><a href="/tags">Tags</a></li>
        </ul>
      </nav>
      <p>Je suis ingénieur informatique, je travail en tant que DevOps chez <a href="//www.manomano.fr">ManoMano</a>. J'aime le développement, le streaming, l'Internet…<br><br>Depuis l'an 2000, j'ai fondé plusieurs webradios Radio-Psylone, Live9 ou encore AddictRadio.</p>
      <ul class="social">
        <li><a class="sc-github" href="//www.github.com/ChoiZ"><i class="fa fa-github"></i></a></li>
        <li><a class="sc-flickr" href="//www.flickr.com/ChoiZ"><i class="fa fa-flickr"></i></a></li>
        <li><a class="sc-lastfm" href="//www.last.fm/user/ChoiZ"><i class="fa fa-lastfm"></i></a></li>
        <li><a class="sc-twitter" href="//www.twitter.com/ChoiZ"><i class="fa fa-twitter"></i></a></li>
        <li><a class="sc-facebook" href="//www.facebook.com/ChoiZ"><i class="fa fa-facebook"></i></a></li>
        <li><a class="sc-foursquare" href="//www.foursquare.com/ChoiZ"><i class="fa fa-foursquare"></i></a></li>
        <li><a class="sc-linkedin" href="//www.linkedin.com/in/ChoiZ"><i class="fa fa-linkedin"></i></a></li>
      </ul>
    </div>
  </aside>
  <main>

<article>
  <header>
    <h1 id="2017-08-26-upgrade-nas">Upgrade NAS</h1>
    <p>Posté le sam. 26 août 2017</p>
  </header>
  <div>
    <p>J'ai acheté il y a quelques années un HP Microserver Gen7 qui me sert de NAS,
dessus j'avais installé Debian 6 à l'époque puis j'ai mis à jour jusqu'à la version 9.</p>
<p>Mon objectif est l'ajout d'un disque car j'ai 4 emplacements pour le stockage et
je n'utilisais que 3 de ses 4 emplacements.</p>
<p>Pour commencer il me fallait un rack 5"¼ permettant de mettre un disque 3"½ ou
2"½, je l'ai trouvé sur <a href="http://www.ldlc.com/fiche/PB00157318.html">LDLC</a> c'est
un "ICY BOX IB-129SSK-B", ensuite j'ai pris sur
<a href="https://www.amazon.fr/gp/product/B01LZY5T8Y/ref=oh_aui_detailpage_o02_s00?ie=UTF8&amp;psc=1">Amazon</a>
un disque Seagate ST500LM030 en 2"½ de 500Go et j'avais ce qu'il fallait pour le
SATA et l'alimentation.</p>
<p>Ce qui m'a permis de mettre un disque 2"½ au niveau de l'emplacement CDROM du HP
Microserver.</p>
<p>J'ai du tué mon uptime d'un an (depuis mon dernier déménagement) :</p>
<div class="highlight"><pre><span></span> 12:31:37 choiz@wayland ~  #❯❯❯ uptime
 12:31:37 up 366 days,  1:08,  1 user,  load average: 0,16, 0,22, 0,24
</pre></div>


<p>Pour la réinstallation j'ai monté un <a href="https://wiki.debian-fr.xyz/PXE_avec_support_EFI">serveur PXE sur
debian</a> merci Benjamin pour le
lien et les conseils.</p>
<p>Installationn du TFTP :</p>
<div class="highlight"><pre><span></span># apt-install -y tftpd-hpa
</pre></div>


<p>Si vous avez un pare-feu n'oubliez pas d'ouvrir le port 69 :</p>
<div class="highlight"><pre><span></span># iptables -A INPUT -p udp -m udp --dport 69 -j ACCEPT
</pre></div>


<p>Installer le serveur DHCP :</p>
<div class="highlight"><pre><span></span># apt install isc-dhcp-server
</pre></div>


<p>Mes IP sont dans le réseau 192.168.1.0/24, mon router en 192.168.1.1, je met un
range entre 192.168.1.100 et 192.168.1.150 mon serveur TFTP est en 192.168.1.2.</p>
<p>Voici la conf d'isc-dhcp-server :</p>
<div class="highlight"><pre><span></span>default-lease-time 600;
max-lease-time 7200;

allow booting;

# in this example, we serve DHCP requests from 192.168.1.(3 to 253)
# and we have a router at 192.168.1.1
subnet 192.168.1.0 netmask 255.255.255.0 {
  range 192.168.1.100 192.168.1.150;
  option broadcast-address 192.168.1.255;
  option routers 192.168.1.1;
  option domain-name-servers 192.168.1.1;
  filename &quot;pxelinux.0&quot;;
}

group {
  next-server 192.168.1.2;
  host tftpclient {
    filename &quot;pxelinux.0&quot;;
  }
}
</pre></div>


<p>Redémarrer le DHCP pour que la config soit prise en compte.</p>
<div class="highlight"><pre><span></span># systemctl restart isc-dhcp-server
</pre></div>


<p>Maintenant nous téléchargeons la dernière version de debian pour la mettre sur
notre TFTP :</p>
<div class="highlight"><pre><span></span># cd /srv/tftp/
# wget -c http://ftp.fr.debian.org/debian/dists/stretch/main/installer-amd64/current/images/netboot/netboot.tar.gz
# tar -zxf netboot.tar.gz
# rm netboot.tar.gz
# systemctl restart tftpd-hpa
</pre></div>


<p>Le PXE est maintenant fonctionnel avec l'installation de debian.</p>
<p>Je réinstall donc debian 9.1 proprement.</p>
<p>Pour éviter d'avoir ses messages d'erreurs :</p>
<div class="highlight"><pre><span></span><span class="n">W</span><span class="o">:</span> <span class="n">Possible</span> <span class="n">missing</span> <span class="n">firmware</span> <span class="sr">/lib/firmware/tigon/</span><span class="n">tg3_tso5</span><span class="o">.</span><span class="na">bin</span> <span class="k">for</span> <span class="n">module</span> <span class="n">tg3</span>
<span class="n">W</span><span class="o">:</span> <span class="n">Possible</span> <span class="n">missing</span> <span class="n">firmware</span> <span class="sr">/lib/firmware/tigon/</span><span class="n">tg3_tso</span><span class="o">.</span><span class="na">bin</span> <span class="k">for</span> <span class="n">module</span> <span class="n">tg3</span>
<span class="n">W</span><span class="o">:</span> <span class="n">Possible</span> <span class="n">missing</span> <span class="n">firmware</span> <span class="sr">/lib/firmware/tigon/</span><span class="n">tg3</span><span class="o">.</span><span class="na">bin</span> <span class="k">for</span> <span class="n">module</span> <span class="n">tg3</span>
</pre></div>


<p>Je modifie mon fichier /etc/apt/sources.list et j'ajoute les "non-free".</p>
<p>Puis j'install le firmware-linux-nonfree :</p>
<div class="highlight"><pre><span></span>apt update
apt install firmware-linux-nonfree
</pre></div>


<p>Il me reste plus qu'a remonter mes disques de backup et de refaire mes partages.</p>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="//www.choiz.fr/tag/nas.html">NAS</a>
      <a href="//www.choiz.fr/tag/hp.html">HP</a>
      <a href="//www.choiz.fr/tag/microserver.html">Microserver</a>
      <a href="//www.choiz.fr/tag/debian.html">Debian</a>
      <a href="//www.choiz.fr/tag/proxmox.html">Proxmox</a>
      <a href="//www.choiz.fr/tag/stockage.html">Stockage</a>
      <a href="//www.choiz.fr/tag/data.html">Data</a>
    </p>
  </div>
</article>

    <footer>
      <p>&copy; François LASSERRE </p>
<p>Built using <a href="http://getpelican.com" target="_blank">Pelican</a> - <a href="https://github.com/choiz/Flexfork" target="_blank">Flexfork</a> theme by <a href="http://www.choiz.fr">François LASSERRE</a></p>    </footer>
  </main>
<!-- Piwik -->
<script type="text/javascript">
  var _paq = _paq || [];
  _paq.push(["setDomains", ["*.www.choiz.fr"]]);
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="//stats.rocketip.net/";
    _paq.push(['setTrackerUrl', u+'piwik.php']);
    _paq.push(['setSiteId', '7042kjNK6PYV9LoGM5np']);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<noscript><p><img src="//stats.rocketip.net/piwik.php?idsite=7042kjNK6PYV9LoGM5np" style="border:0;" alt="" /></p></noscript>
<!-- End Piwik Code --><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BlogPosting",
  "name": "Upgrade NAS",
  "headline": "Upgrade NAS",
  "datePublished": "2017-08-26 11:04:27+02:00",
  "dateModified": "",
  "author": {
    "@type": "Person",
    "name": "choiz",
    "url": "//www.choiz.fr/author/choiz.html"
  },
  "image": "{{ SITEURL }}/theme/img/profile.png",
  "url": "//www.choiz.fr/2017-08-26-upgrade-nas.html",
  "description": "J'ai acheté il y a quelques années un HP Microserver Gen7 qui me sert de NAS, dessus j'avais installé Debian 6 à l'époque puis j'ai mis à jour jusqu'à la version 9. Mon objectif est l'ajout d'un disque car j'ai 4 emplacements pour le stockage et je n'utilisais que 3 …"
}
</script></body>
</html>